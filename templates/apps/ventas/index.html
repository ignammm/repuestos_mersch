{% extends 'layouts/base.html' %}

{% block title %}Ventas{% endblock %}

{% block content %}
<h1>Ventas</h1>

<!-- Formulario de filtros -->
<form method="GET" class="mb-4">
    <div class="row">
        <div class="col-md-3">
            <label for="fecha_inicio">Fecha desde:</label>
            <input type="date" name="fecha_inicio" id="fecha_inicio" value="{{ request.GET.fecha_inicio }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label for="fecha_fin">Fecha hasta:</label>
            <input type="date" name="fecha_fin" id="fecha_fin" value="{{ request.GET.fecha_fin }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label for="codigo">Código:</label>
            <input type="text" name="codigo" id="codigo" value="{{ request.GET.codigo }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label for="reposicion">Reposición:</label>
            <select name="reposicion" id="reposicion" class="form-control">
                <option value="" {% if request.GET.reposicion == "" %}selected{% endif %}>Todos</option>
                <option value="Sí" {% if request.GET.reposicion == "Sí" %}selected{% endif %}>Sí</option>
                <option value="No" {% if request.GET.reposicion == "No" %}selected{% endif %}>No</option>
            </select>
        </div>
    </div>
    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{% url 'ventas:index' %}" class="btn btn-secondary">Limpiar filtros</a>
    </div>
</form>

<!-- Tabla de ventas -->
<table class="table">
    <thead>
        <tr>
            <td>Fecha</td>
            <td>Cantidad</td>
            <td>Código</td>
            <td>Monto</td>
            <td>Reposición</td>
        </tr>
    </thead>
    <tbody>
        {% for venta in ventas %}
        <tr>
            <td>{{ venta.fecha }}</td>
            <td>{{ venta.cantidad }}</td>
            <td>{{ venta.articulo.Articulo }}</td>
            <td>{{ venta.monto_total }}</td>
            <td>{{ venta.reposicion }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">No hay ventas registradas</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Paginación -->
<div class="pagination">
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if ventas.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?{% if query_params %}{{ query_params }}&{% endif %}page=1">Primera</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?{% if query_params %}{{ query_params }}&{% endif %}page={{ ventas.previous_page_number }}">Anterior</a>
            </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">Página {{ ventas.number }} de {{ ventas.paginator.num_pages }}</span>
            </li>

            {% if ventas.has_next %}
            <li class="page-item">
                <a class="page-link" href="?{% if query_params %}{{ query_params }}&{% endif %}page={{ ventas.next_page_number }}">Siguiente</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?{% if query_params %}{{ query_params }}&{% endif %}page={{ ventas.paginator.num_pages }}">Última</a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>

{% endblock %}
